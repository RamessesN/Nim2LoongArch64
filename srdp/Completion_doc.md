<div align="center">
    <h1> Nim语言编译器面向LoongArch迁移研究 </h1>
</div>

## I. 项目执行情况
### 1. 本项目的选题背景、目的与意义
- ***Nim* 语言特性**
[*Nim*](https://nim-lang.org) 语言是一门静态类型、编译型的系统级编程语言，以其优雅且现代化的语法著称。它在保持接近 *C* 语言运行效率的同时，提供了堪比 *Python* 的开发效率与代码可读性，实现了真正意义上的“零成本抽象” (zero-overhand)。
*Nim* 融合了 *Pascal* , *Python*, *Ada* 和 *Modula* 等语言的设计思想，并在语言特性上影响了包括 *Rust*, *Cangjie* (仓颉) 在内的多种现代语言。
除编译执行外， *Nim* 代码也可作为 *NimScript* 进行解释执行。它支持 “一套代码，多后端” 的编译模式，可将源代码编译为 *C*、*C++* 或 *JavaScript*，从而具备极高的跨平台性与语言互操作性。灵活而高效的 **FFI** (外部函数接口) 进一步提升了与其他语言集成的便利性。
内存管理方面，*Nim* 采用 **ORC**（Ownership-based Reference Counting）机制，即基于 **ARC (Automatic Reference Counting)** 的增强版并辅以小型循环检测器。
这一方案在保证内存安全的同时，通过 **sink参数** 与 **写时复制 (copy on write)** 等优化技术，将性能损耗降至极低。与 *C* 的手动内存管理以及 *C++ / Rust* 的 **RAII** 或强制所有权检查不同，*Nim* 在性能、安全与易用性之间取得了极佳的平衡，使开发体验更加高效与轻量。
<br>

- ***LoongArch* 介绍**
[*LoongArch*](https://www.loongson.cn/system/loongarch) (龙芯架构) 是一款由中国自主研发的通用指令集架构 (ISA)。它在设计上充分吸收了近年来国际主流指令集的发展成果，具备 **完全自主、技术先进、生态兼容** 三大特性。
*LoongArch* 架构以高代码执行效率为核心优势，支持高效的二进制翻译机制，兼顾性能与兼容性。不仅在硬件层面便于实现高性能、低功耗设计，在软件生态方面也更利于编译优化、操作系统和虚拟机的开发与适配。
在 *ARM* 与 *x86* 等架构受国际技术封锁背景下，*LoongArch* 的出现对推动国产计算体系自主化、增强国家科技竞争力及保障信息安全具有重要的战略意义。
<br>

- ***Nim2LoongArch* 迁移项目介绍**
*Nim2LoongArch* 项目旨在实现 *Nim* 语言在 *LoongArch* (龙芯) 架构下的完整迁移。这一工作不仅有助于完善龙芯的语言生态体系，也为龙芯平台的开发提供了一种更安全、高效且易用的编程语言选项，从而进一步推动软件国产化与自主生态建设。
在全球范围内愈发重视使用“内存安全语言”进行软件开发的背景下，*Nim* 以其接近 *C* 的性能、比 *Python* 高出数十倍的运行效率，以及相较 *Rust* 更简洁易用的开发体验，为安全与效率兼顾的软件开发提供了新的可行路径。
开源于 [GitHub](https://github.com/nim-lang/Nim) 平台，*Nim* 拥有活跃的国际社区与完善的生态体系，其官方包管理器 [Nimble](https://github.com/nim-lang/nimble) 提供了高效的依赖管理与丰富的第三方库支持。*Nim* 语法优雅、表现力强，源代码结构清晰，便于阅读与维护，具备较高的科研与工程应用参考价值。
故而，我们希望能通过完成 *Nim2LoongArch* 的迁移以实现：
    1️⃣ 完善国产龙芯 CPU 的语言与工具链生态
    2️⃣ 探索软件国产化过程中的更优技术路径
    3️⃣ 完成 *Nim* 编译器在龙芯平台下的适配与优化，提升其跨平台能力
    4️⃣ 推进 *Nim* 语言在国产软件开发领域的实际应用

### 2. 项目的创新点与特色
- **基于架构相似性的跨平台迁移策略**
充分利用 *LoongArch* 与 *MIPS* 架构在指令集层面的高度相似性，结合 *Nim* 编译器通过 “ *C* 语言中间层转译“ 的特性，采用面向 *MIPS* 的 *Nim* 源码生成机制，在龙芯平台上实现本机编译，成功构建出可在 *LoongArch* 架构下独立运行的 *Nim* 编译器。这一策略有效降低了移植难度，避免了底层指令级适配的复杂性。
- **利用编译器自举特性实现高效迁移**
借助 [*Nim*](https://nim-lang.org) 自举 (编译器由 *Nim* 自身实现而非 *C* 语言实现) 的语言特性，实现编译器在龙芯平台上的直接构建，避免了多轮交叉编译过程，大幅提升了迁移效率与稳定性。
- **构建面向 *LoongArch* 的现代化编译系统**
在迁移过程中，针对龙芯平台的特性对编译链进行了适配与优化，为 *LoongArch* 架构引入了更现代化、更具扩展性的编译系统，为未来的工具链完善与生态建设奠定了基础。
- **促进国产开源生态的兼容与发展**
向多个上游开源仓库提交龙芯相关补丁与兼容性优化，推动 *LoongArch* 在国际开源社区中的可见度与支持度，为国产 CPU 架构的生态完善和开源认同提供了持续助力。

### 3. 团队成员分工和合作情况
- **队长**
    + **蔺春明** - 负责整体项目计划、环境搭建与进度监督
- **队员**
    + **赵禹惟** - 负责仓库版本管理、材料撰写与文案整理
    + **於佳杰** - 负责项目推进、分析错误模块
    + **李佳潼** - 负责资料查阅与材料收集
    + **徐启睿** - 负责测试与 bug 修复

### 4. 成果简述（项目成果主要内容、重要观点或对策建议、论文发表、竞赛获奖、专利/著作权、实物制作、注册公司、孵化器入孵等情况。成果可简要阐述，详细信息可前往成果管理菜单下进行提交）
<竞赛获奖> - 2024年，CSCC 全国大学生计算机系统能力大赛操作系统设计赛，华东赛区优胜奖
<h5> TODO: 剩下的你写 </h5>

---

## II. 研究总结报告
### 1. 预定计划执行情况，项目研究和实践情况（含进度安排、完成内容、关键技术及效果等）
- **阶段一：准备与环境配置 (2024.11 - 2024.12)**
    + **目标：**
    搭建项目开发环境，完成 *C* 与 *Nim* 编译环境配置，确认龙芯平台的基本工具链可用性。
    + **任务：**
    1. 配置 *LoongArch64* (龙芯) 环境，并安装基本开发工具链 (*GCC / Clang*)。
    2. 获取并准备 *Nim* 源码，包括 *Nim* 主仓库和 *csources_v2* 仓库。
    3. 阅读 *Nim* 编译器源码，特别是与架构相关的部分，了解现有 *MIPS64le* 的支持情况。
    4. 初步测试从 *MIPS64le* 配置编译的 *Nim C* 代码在 *LoongArch64* 上的可执行性，如 `nim --version`。

- **阶段二：伪交叉编译与初步一致 (2025.01 - 2025.02)**
    + **目标：**
    实现 *Nim* 编译器的伪交叉编译，生成可在 *LoongArch64* 上运行的版本。
    + **任务：**
    1. 配置 *Nim* 编译器进行伪交叉编译，使用 *MIPS64le* 生成中间 *C* 代码。
    2. 在 *LoongArch64* 本地编译生产的 *C* 代码，获得 *Nim* 编译器。
    3. 分析和修复初步移植中出现的编译错误。
    4. 验证生成的编译器能否执行基本 *Nim* 命令。

- **阶段三：本地编译与深入源码修改 (2025.02 - 2025.04)**
    + **目标：**
    使用 *LoongArch64* 环境下生成的 *Nim* 编译器编译 *Nim* 源码，解决迁移过程中的架构相关问题。
    + **任务：**
    1. 使用 *LoongArch64* 环境下生成的 *Nim* 编译器编译 *Nim* 源码，生成本地架构版本的 *Nim* 编译器。
    2. 详细分析编译过程中涉及 *LoongArch* 架构的报错，定位并修改相关 *C* 代码与 *Nim* 代码。
    3. 提交初步的源码修改，记录每次修改后的测试结果。
    4. 与 *Nim* 社区保持沟通，了解其他架构移植过程中可能遇到的类似问题。

- **阶段四：集成测试与优化 (2025.04 - 2025.09)**
    + **目标：**
    通过 *Nim* 语言的所有集成测试，并优化源码以确保 *LoongArch64* 的兼容性和性能。
    + **任务：**
    1. 使用 *LoongArch64* 版本的 *Nim* 编译器运行 *Nim* 的集成测试 (`nim testament all`)。
    2. 收集并分析测试失败的用例，确定问题是否与 *LoongArch* 架构相关。
    3. 根据测试结果，修改对应的源码部分 (可能涉及 *Nim* 编译器、*C* 代码和 *Nim* 标准库)。
    4. 在 *Nim* 社区中发布进度更新，并请求社区成员协助测试和提供反馈。

- **阶段五：代码贡献与 *Pull Request* 提交 (2025.09 - 2025.10)**
    + **目标：**
    提交修改补丁至 *Nim* 官方仓库，推动 *LoongArch* 的官方支持，并完成项目总结。
    + **任务：**
    1. 整理所有修改过的源码文件和补丁，准备 *Pull Request* 提交给 *Nim* 的官方仓库。
    2. 在 *GitHub* 上提交 *Pull Request*，详细说明每个修改的原因和测试结果。
    3. 与 *Nim* 的维护者沟通，回答可能的代码审查问题，并根据反馈进行进一步调整。
    4. 在龙芯架构操作系统的包管理器中配置 *Nim* 语言包，并测试其安装和运行效果。
    5. 撰写项目总结报告，记录从交叉编译到本地编译、源码修改和测试的全过程。

### 2. 项目实施的收获与体会，项目工作有哪些不足，项目工作中困难与解决方法
<h5> TODO: 这个你写 </h5>

---

## III. 经费开支与报销情况
### 1. 经费报销情况
<h5> TODO: 这个你写 </h5>